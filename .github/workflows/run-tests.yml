name: Run tests

on:
  push:
    branches:
      - master
      - v2.0
  pull_request:
  schedule:
      - cron: '0 0 * * *'

jobs:
    php-tests:
        runs-on: ubuntu-latest
        container:

        strategy:
            matrix:
                environment:
                    - php_version: 8.1
                      laravel_version: 10
                    - php_version: 8.2
                      laravel_version: 10
                    - php_version: 8.2
                      laravel_version: 11
                    - php_version: 8.3
                      laravel_version: 11

        name: PHP ${{ matrix.environment.php_version }} & Laravel ${{ matrix.environment.laravel_version }} - ubuntu-latest

        steps:
            - name: Checkout code
              uses: actions/checkout@v1

            - name: Setup PHP
              uses: shivammathur/setup-php@v2
              with:
                  php-version: ${{ matrix.environment.php_version }}
                  coverage: none

            - name: Install dependencies
              run: |
                  rm -f composer.lock
                  sudo composer self-update
                  composer require laravel/framework:^${{ matrix.environment.laravel_version }}.0 -W
                  composer require enlightn/security-checker

            - name: Execute tests
              run: vendor/bin/phpunit

